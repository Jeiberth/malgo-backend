# # .platform/nginx/conf.d/laravel.conf

# # Set the CORRECT root directory for Laravel applications on EB AL2/AL2023
# # This should apply within the server block where this file is included.
# # root /var/app/current/public;

# # # Prioritize index.php for directory requests
# # index index.php;

# # Add the crucial location block with try_files for Laravel routing
# location / {
#     try_files $uri $uri/ /index.php?$query_string;
# }

# # Optional: Deny access to dot files like .htaccess or .env if they accidentally get deployed
# location ~ /\. {
#     deny all;
# }

# # Optional: Add headers for security (example)
# # add_header X-Frame-Options "SAMEORIGIN";
# # add_header X-Content-Type-Options "nosniff";
# # add_header Referrer-Policy "strict-origin-when-cross-origin";

server {
    listen 80;
    root /var/app/current/public;
    index index.php index.html index.htm;
    server_name _;

    location / {
        try_files $uri $uri/ /index.php?$query_string;
    }

    location ~ \.php$ {
        # include fastcgi_params;
        include /etc/nginx/fastcgi_params;
        fastcgi_pass php-fpm;
        fastcgi_index index.php;
        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
    }

    location ~ /\. {
        deny all;
    }

    # Optional: security headers
    # add_header X-Frame-Options "SAMEORIGIN";
    # add_header X-Content-Type-Options "nosniff";
    # add_header Referrer-Policy "strict-origin-when-cross-origin";
}
